<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>

    <!-- ROBOTO MONO FONT -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500&display=swap"
      rel="stylesheet"
    />

    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/chart.js"
    ></script>
    <link
      rel="icon"
      href="https://www.bsi.ac.id/ubsi/assets/img/logo_ubsi.png"
      type="image/x-icon"
    />
    <title>Moving Average</title>
  </head>
  <body>
    <div class="container py-4">
      <h2 class="mb-1 fw-semibold">Moving average</h2>
      <p class="text-secondary">
        Aplikasi data analis moving average kelompok 9 Mata Kuliah Statistika
      </p>
      <!-- INPUT FORM -->
      <div class="form-group row mb-3">
        <label class="col-form-label col-xl-10 text-secondary"
          >Input the data</label
        >
        <div class="input-group col-xl-10">
          <input
            id="data_input"
            type="number"
            class="form-control"
            placeholder="Data"
          />
          <button id="button_add" class="btn btn-primary">
            <svg
              class="mb-1"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-plus-circle-fill"
              viewBox="0 0 16 16"
            >
              <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"
              />
            </svg>
          </button>
        </div>
      </div>
      <!-- INPUT FORM -->

      <div>
        <table class="table">
          <thead>
            <tr>
              <th scope="col">No</th>
              <th scope="col">Data</th>
            </tr>
          </thead>
          <tbody id="table_body">
            <!-- <tr>
              <th scope="row">1</th>
              <td>Mark</td>
            </tr>
            <tr>
              <th scope="row">2</th>
              <td>Jacob</td>
            </tr> -->
          </tbody>
        </table>
      </div>

      <div id="calculate" class="row form-group py-4 d-none">
        <div class="col-4">
          <input
            id="interval"
            type="number"
            class="form-control"
            placeholder="Interval"
          />
        </div>

        <div class="col-8">
          <button disabled id="button_calculate" class="btn btn-primary">
            <svg
              class="me-1 mb-1"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-calculator-fill"
              viewBox="0 0 16 16"
            >
              <path
                d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm2 .5v2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5zm0 4v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zM4.5 9a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM4 12.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zM7.5 6a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM7 9.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zm.5 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM10 6.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zm.5 2.5a.5.5 0 0 0-.5.5v4a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-.5-.5h-1z"
              />
            </svg>
            Calculate
          </button>

          <button id="button_clear" class="btn btn-danger">
            <svg
              class="me-1 mb-1"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-trash"
              viewBox="0 0 16 16"
            >
              <path
                d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"
              />
              <path
                d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"
              />
            </svg>
            Clear
          </button>
        </div>
      </div>

      <div
        id="chart_container"
        class="my-4 chart-container d-none"
        style="position: relative"
      >
        <h4 class="text-center text-secondary">Moving average</h4>
        <canvas style="margin-bottom: 30px" id="trends"></canvas>
      </div>
    </div>

    <script>
      const buttton_add = document.getElementById("button_add");
      const data_input = document.getElementById("data_input");
      const table_body = document.getElementById("table_body");
      const calculate = document.getElementById("calculate");
      const interval = document.getElementById("interval");
      const button_calculate = document.getElementById("button_calculate");
      const chart_container = document.getElementById("chart_container");
      const button_clear = document.getElementById("button_clear");

      let table_data = document.getElementsByClassName("table_data");
      let th_label = document.getElementsByClassName("th_label");
      let min_value = 1;

      let data = [];
      let labels = [];
      let forecast = [];

      let numbering = 0;

      data_input.onkeypress = function (event) {
        if (event.key === "Enter") {
          buttton_add.click();
          data_input.value = "";
        } else {
          return /[0-9-.]/i.test(event.key);
        }
      };

      function addDataToTable() {
        if (data_input.value != "") {
          let tr = document.createElement("tr");

          let th = document.createElement("th");
          th.setAttribute("scope", "row");
          th.setAttribute("class", "th_label");
          th.textContent = numbering += 1;

          let td = document.createElement("td");
          td.setAttribute("class", "table_data");
          td.textContent = data_input.value;

          tr.appendChild(th);
          tr.appendChild(td);

          table_body.appendChild(tr);

          renderCalculate();
        }
      }

      buttton_add.onclick = addDataToTable;

      renderCalculate = () => {
        if (table_body.childElementCount >= min_value) {
          calculate.classList.remove("d-none");
        }
      };

      interval.oninput = () => {
        if (interval.value != "") {
          button_calculate.removeAttribute("disabled");
        } else {
          button_calculate.setAttribute("disabled", true);
        }
      };
      interval.onkeypress = function (event) {
        if (event.key === "Enter") {
          button_calculate.click();
          // interval.value = "";
        } else {
          return /[0-9-.]/i.test(event.key);
        }
      };

      function enableButtonCalculate() {
        interval.onchange = function (event) {
          if (Number(interval.value)) {
            console.info("TRUE");
          }
        };
      }

      button_calculate.onclick = () => {
        let array_table_data = [];

        for (let i = 0; i < table_data.length; i++) {
          data.push(Number(table_data[i].textContent));
          labels.push(Number(th_label[i].textContent));

          if (i >= interval.value - 1) {
            forecast_sum = 0;

            for (let j = 0; j < interval.value; j++) {
              forecast_sum += Number(data[i - j]);
              // console.info(i + " - " + j + " = " + (i - j));
            }
            console.log(forecast_sum);
            console.log(
              forecast_sum +
                " / " +
                interval.value +
                " = " +
                Math.ceil(forecast_sum / interval.value)
            );
            forecast.push(Math.ceil(forecast_sum / interval.value));
          }
        }

        for (let i = 0; i < Number(interval.value - 1); i++) {
          forecast.unshift(null);
        }

        chart_container.classList.remove("d-none");
        console.info("Maks: " + Math.ceil(Math.max(...data) / 10) * 10);
        console.info(data);

        // TRENDS
        var ctxt = document.getElementById("trends").getContext("2d");
        var trends = new Chart(ctxt, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                data: data,
                label: "Data",
                borderColor: "rgb(62,149,205)",
                backgroundColor: "rgb(62,149,205)",
                fill: false,
                tension: 0.3,
              },
              {
                data: forecast,
                label: "Forecast",
                borderColor: "rgb(196,88,180)",
                backgroundColor: "rgb(196,88,180)",
                fill: false,
                tension: 0.3,
              },
            ],
          },
          options: {
            maintainAspectRatio: false,
            scales: {
              y: {
                type: "linear",
                position: "left",
                stack: "demo",
                title: {
                  display: true,
                  text: "value",
                },
              },
            },
            plugins: {
              legend: {
                display: true,
                position: "bottom",
              },
            },
          },
        });
        trends.canvas.parentNode.style.height = "350px";
        // TRENDS
      };

      function clearAllData() {
        data = [];
        labels = [];
        forecast = [];
        while (table_body.firstChild) {
          table_body.removeChild(table_body.firstChild);
        }
        calculate.classList.add("d-none");
        numbering = 0;

        while (chart_container.firstChild) {
          chart_container.removeChild(chart_container.firstChild);
        }

        let h4 = document.createElement("h4");
        h4.setAttribute("class", "text-center text-secondary");
        h4.textContent = "Moving Average";

        let canvas = document.createElement("canvas");
        canvas.setAttribute("id", "trends");
        canvas.style.marginBottom = "30px";

        chart_container.appendChild(h4);
        chart_container.appendChild(canvas);

        chart_container.classList.add("d-none");
      }

      button_clear.onclick = () => {
        clearAllData();
      };
    </script>
  </body>
</html>
