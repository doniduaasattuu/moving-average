<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>

    <!-- ROBOTO MONO FONT -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500&display=swap"
      rel="stylesheet"
    />

    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/chart.js"
    ></script>

    <title>Moving Average</title>
  </head>
  <body>
    <div class="container py-4">
      <h2>Moving average</h2>
      <!-- INPUT FORM -->
      <div class="form-group row mb-3">
        <label class="col-form-label col-xl-10 text-secondary"
          >Input the data</label
        >
        <div class="input-group col-xl-10">
          <input
            id="data_input"
            type="number"
            class="form-control"
            placeholder="Data"
          />
          <button id="button_add" class="btn btn-primary">
            <svg
              class="mb-1"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-plus-circle-fill"
              viewBox="0 0 16 16"
            >
              <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"
              />
            </svg>
          </button>
        </div>
      </div>
      <!-- INPUT FORM -->

      <div>
        <table class="table">
          <thead>
            <tr>
              <th scope="col">No</th>
              <th scope="col">Data</th>
            </tr>
          </thead>
          <tbody id="table_body">
            <!-- <tr>
              <th scope="row">1</th>
              <td>Mark</td>
            </tr>
            <tr>
              <th scope="row">2</th>
              <td>Jacob</td>
            </tr> -->
          </tbody>
        </table>
      </div>

      <div id="calculate" class="row form-group py-4 d-none">
        <div class="col">
          <input
            id="interval"
            type="number"
            class="form-control"
            placeholder="Interval"
          />
        </div>

        <div class="col">
          <button disabled id="button_calculate" class="btn btn-primary">
            <svg
              class="me-1 mb-1"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-calculator-fill"
              viewBox="0 0 16 16"
            >
              <path
                d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm2 .5v2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5zm0 4v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zM4.5 9a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM4 12.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zM7.5 6a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM7 9.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zm.5 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM10 6.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zm.5 2.5a.5.5 0 0 0-.5.5v4a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-.5-.5h-1z"
              />
            </svg>
            Calculate
          </button>
        </div>
      </div>

      <div
        id="chart_container"
        class="my-4 chart-container d-none"
        style="position: relative"
      >
        <h4 class="text-center text-secondary">Moving average</h4>
        <canvas style="margin-bottom: 30px" id="trends"></canvas>
      </div>
    </div>

    <script>
      const buttton_add = document.getElementById("button_add");
      const data_input = document.getElementById("data_input");
      const table_body = document.getElementById("table_body");
      const calculate = document.getElementById("calculate");
      const interval = document.getElementById("interval");
      const button_calculate = document.getElementById("button_calculate");
      const chart_container = document.getElementById("chart_container");
      let table_data = document.getElementsByClassName("table_data");
      let min_value = 1;
      let datas = [12, 32, 43, 21, 43, 32, 12, 32, 33, 12, 23, 29];
      let data = [];

      let th_label = document.getElementsByClassName("th_label");
      let labels = [];
      let label = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];

      let forecasts = [32, 12, 32, 33, 15, 39, 43, 26, 30, 12, 13, 39];
      let forecast = [];

      let numbering = 0;

      data_input.onkeypress = function (event) {
        if (event.key === "Enter") {
          buttton_add.click();
          data_input.value = "";
        } else {
          return /[0-9-.]/i.test(event.key);
        }
      };

      function addDataToTable() {
        if (data_input.value != "") {
          let tr = document.createElement("tr");

          let th = document.createElement("th");
          th.setAttribute("scope", "row");
          th.setAttribute("class", "th_label");
          th.textContent = numbering += 1;

          let td = document.createElement("td");
          td.setAttribute("class", "table_data");
          td.textContent = data_input.value;

          tr.appendChild(th);
          tr.appendChild(td);

          table_body.appendChild(tr);

          renderCalculate();
        }
      }

      buttton_add.onclick = addDataToTable;

      renderCalculate = () => {
        if (table_body.childElementCount >= min_value) {
          calculate.classList.remove("d-none");
        }
      };

      interval.oninput = () => {
        if (interval.value != "") {
          button_calculate.removeAttribute("disabled");
        } else {
          button_calculate.setAttribute("disabled", true);
        }
      };
      interval.onkeypress = function (event) {
        if (event.key === "Enter") {
          button_calculate.click();
          // interval.value = "";
        } else {
          return /[0-9-.]/i.test(event.key);
        }
      };

      function enableButtonCalculate() {
        interval.onchange = function (event) {
          if (Number(interval.value)) {
            console.info("TRUE");
          }
        };
      }

      button_calculate.onclick = () => {
        let array_table_data = [];

        for (let i = 0; i < table_data.length; i++) {
          data.push(Number(table_data[i].textContent));
          labels.push(Number(th_label[i].textContent));

          if (i >= interval.value - 1) {
            forecast_sum = 0;

            for (let j = 0; j < interval.value; j++) {
              forecast_sum += Number(data[i - j]);
              console.info("i: " + i + " - " + "j: " + j);
            }
            console.log(forecast_sum);
            //(Number(data[i]) + Number(data[i - 1]) + Number(data[i - 2])) /
            // Number(interval.value)
            forecast.push(Math.floor(forecast_sum / interval.value));
          }
        }

        for (let i = 0; i < Number(interval.value - 1); i++) {
          forecast.unshift(null);
        }

        console.info(forecast);
        chart_container.classList.remove("d-none");
      };

      // TRENDS
      var ctxt = document.getElementById("trends").getContext("2d");
      var trends = new Chart(ctxt, {
        type: "line",
        data: {
          labels: labels,
          datasets: [
            {
              data: data,
              label: "Data",
              borderColor: "rgb(62,149,205)",
              backgroundColor: "rgb(62,149,205)",
              fill: false,
              tension: 0.3,
            },
            {
              data: forecast,
              label: "Forecast",
              borderColor: "rgb(196,88,180)",
              backgroundColor: "rgb(196,88,180)",
              fill: false,
              tension: 0.3,
            },
          ],
        },
        options: {
          maintainAspectRatio: false,
          scales: {
            y: {
              type: "linear",
              position: "left",
              stack: "demo",
              title: {
                display: true,
                text: "value",
              },
              ticks: {
                stepSize: 5,
              },
            },
          },
        },
      });
      trends.canvas.parentNode.style.height = "350px";
      trends.options.plugins.legend.position = "bottom";
      // TRENDS
    </script>
  </body>
</html>
